<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>了解游标类型</title><meta name="Language" content="zh-CN" /><meta name="System.Keywords" content="游标类型" /><meta name="Microsoft.Help.Id" content="4f4d3db7-4f76-450d-ab63-141237a4f034" /><meta name="Description" content="关系数据库中的操作会对整个行集起作用。由 SELECT 语句返回的行集包括满足该语句的 WHERE 子句中条件的所有行。这种由语句返回的完整行集称为结果集。应用程序并不总能将整个结果集作为一个单元来有效地处理。这些应用程序需要一种机制以便每次处理一行或一小部分行。游标不仅可提供这种机制，而且是对结果集的一种扩展。" /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">了解游标类型</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>关系数据库中的操作会对整个行集起作用。由 SELECT 语句返回的行集包括满足该语句的 WHERE 子句中条件的所有行。这种由语句返回的完整行集称为结果集。应用程序并不总能将整个结果集作为一个单元来有效地处理。这些应用程序需要一种机制以便每次处理一行或一小部分行。游标不仅可提供这种机制，而且是对结果集的一种扩展。</p><p>游标通过执行以下操作来扩展结果集处理：</p><ul><li><p>允许定位在结果集的特定行。</p></li><li><p>从结果集的当前位置检索一行或一部分行。</p></li><li><p>支持对结果集中当前位置的行进行数据修改。</p></li><li><p>为由其他用户对显示在结果集中的数据库数据所做的更改提供不同级别的可见性支持。</p></li></ul><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>有关 SQL Server 游标类型的完整说明，请参阅 SQL Server 联机丛书中的“游标类型（数据库引擎）”主题。</p></div><p>JDBC 规范支持的只进和可滚动游标对其他作业所做的更改可能敏感，也可能不敏感，而且可以是只读游标或可更新游标。这一功能由 Microsoft JDBC Driver for SQL Server 的 <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> 类提供。</p></div><h1 class="heading">备注</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>JDBC 驱动程序支持以下游标类型：</p><div class="tableSection"><table width="50%" cellspacing="2" cellpadding="5" frame="lhs"><tr><th><p>结果集</p><p>（游标）类型</p></th><th><p>SQL Server 游标类型</p></th><th><p>特征</p></th><th><p>选择</p><p>方法</p></th><th><p>响应</p><p>缓冲</p></th><th><p>说明</p></th></tr><tr><td><p>TYPE_FORWARD_ONLY (CONCUR_READ_ONLY)</p></td><td><p>不适用</p></td><td><p>只进，只读</p></td><td><p>direct</p></td><td><p>full</p></td><td><p>应用程序必须（向前）经过结果集一次。这是默认行为，其行为与 TYPE_SS_DIRECT_FORWARD_ONLY 游标的方式相同。在语句执行期间，驱动程序将整个结果集从服务器读入内存中。</p></td></tr><tr><td><p>TYPE_FORWARD_ONLY (CONCUR_READ_ONLY)</p></td><td><p>不适用</p></td><td><p>只进，只读</p></td><td><p>direct</p></td><td><p>adaptive</p></td><td><p>应用程序必须（向前）经过结果集一次。其行为与 TYPE_SS_DIRECT_FORWARD_ONLY 游标的行为相同。当应用程序请求行时，驱动程序从服务器读取对应的行，这样可以最大限度地减少客户端内存占用。</p></td></tr><tr><td><p>TYPE_FORWARD_ONLY (CONCUR_READ_ONLY)</p></td><td><p>快进</p></td><td><p>只进，只读</p></td><td><p>cursor</p></td><td><p>不适用</p></td><td><p>应用程序必须通过使用服务器游标在结果集中进行一次（前进）传递。其行为与 TYPE_SS_SERVER_CURSOR_FORWARD_ONLY 游标的行为相同。</p><p>从提取大小指定的服务器中分块检索行。</p></td></tr><tr><td><p>TYPE_FORWARD_ONLY (CONCUR_UPDATABLE)</p></td><td><p>动态（只进）</p></td><td><p>只进，可更新</p></td><td><p>不适用</p></td><td><p>不适用</p></td><td><p>应用程序必须（向前）经过结果集一次才能更新一行或多行。</p><p>从提取大小指定的服务器中分块检索行。</p><p>默认情况下，当应用程序调用 <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> 对象的 <a href="233bf4f8-4758-42d0-a80b-33e34fa78027.htm">setFetchSize</a> 方法时，提取大小是固定的。</p><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>JDBC 驱动程序提供一项自适应缓冲功能，使您可以在应用程序需要时从 SQL Server 中检索语句执行结果，而不是一次性检索全部结果。例如，如果应用程序需要检索一个因为太大而无法完全容纳于应用程序内存中的大型数据块，则自适应缓冲使客户端应用程序可以检索诸如流这样的值。</p><p>驱动程序的默认行为是“<span sdata="langKeyword" value="adaptive"><span class="keyword">adaptive</span></span>”。但是，若要为只进的可更新结果集获取自适应缓冲，应用程序必须通过提供 <span sdata="langKeyword" value="String"><span class="keyword">String</span></span> 值“<span sdata="langKeyword" value="adaptive&quot;"><span class="keyword">adaptive"</span></span>”来显式调用 <a href="ec24963c-8b51-4838-91e9-1fbfa2347451.htm">SQLServerStatement</a> 对象的 <a href="9f489835-6cda-4c8c-b139-079639a169cf.htm">setResponseBuffering</a> 方法。有关示例代码，请参阅<span sdata="link"><a href="76ecc05f-a77d-40a2-bab9-91a7fcf17347.htm">更新大型数据的示例</a></span>。</p></div></td></tr><tr><td><p>TYPE_SCROLL_INSENSITIVE</p></td><td><p>静态</p></td><td><p>可滚动，不可更新。</p><p>外部行更新、插入和删除不可见。</p></td><td><p>不适用</p></td><td><p>不适用</p></td><td><p>应用程序需要数据库快照。结果集不可更新。仅支持 CONCUR_READ_ONLY。使用此游标类型时，所有其他并发类型都将导致异常。</p><p>从提取大小指定的服务器中分块检索行。</p></td></tr><tr><td><p>TYPE_SCROLL_SENSITIVE</p><p>(CONCUR_READ_ONLY)</p></td><td><p>键集</p></td><td><p>可滚动，只读。外部行更新可见，删除显示为缺失数据。</p><p>外部行插入不可见。</p></td><td><p>不适用</p></td><td><p>不适用</p></td><td><p>应用程序必须只看到现有行的已更改数据。</p><p>从提取大小指定的服务器中分块检索行。</p></td></tr><tr><td><p>TYPE_SCROLL_SENSITIVE</p><p>（CONCUR_UPDATABLE、CONCUR_SS_SCROLL_LOCKS、CONCUR_SS_OPTIMISTIC_CC、CONCUR_SS_OPTIMISTIC_CCVAL）</p></td><td><p>键集</p></td><td><p>可滚动，可更新。</p><p>外部和内部行更新可见，删除显示为缺失数据；插入不可见。</p></td><td><p>不适用</p></td><td><p>不适用</p></td><td><p>应用程序使用 <b>ResultSet</b> 对象可能更改现有行的数据。应用程序还必须能够从 <b>ResultSet</b> 对象之外看到其他用户对行所做的更改。</p><p>从提取大小指定的服务器中分块检索行。</p></td></tr><tr><td><p>TYPE_SS_DIRECT_FORWARD_ONLY</p></td><td><p>不适用</p></td><td><p>只进，只读</p></td><td><p>不适用</p></td><td><p>full 或 adaptive</p></td><td><p>整数值 = 2003。提供一个完全缓冲的只读客户端游标。不创建服务器游标。</p><p>仅支持 CONCUR_READ_ONLY 并发类型。使用此游标类型时，所有其他并发类型都将导致异常。</p></td></tr><tr><td><p>TYPE_SS_SERVER_CURSOR_FORWARD_ONLY</p></td><td><p>快进</p></td><td><p>只进</p></td><td><p>不适用</p></td><td><p>不适用</p></td><td><p>整数值 = 2004。快速，使用服务器游标访问所有数据。使用 CONCUR_UPDATABLE 并发类型时可更新。</p><p>从提取大小指定的服务器中分块检索行。</p><p>对于这种情况，为了获得自适应缓冲，应用程序必须通过提供一个 <span sdata="langKeyword" value="String"><span class="keyword">String</span></span> 值“<span sdata="langKeyword" value="adaptive&quot;"><span class="keyword">adaptive"</span></span>”，显式调用 <a href="ec24963c-8b51-4838-91e9-1fbfa2347451.htm">SQLServerStatement</a> 对象的 <a href="9f489835-6cda-4c8c-b139-079639a169cf.htm">setResponseBuffering</a> 方法。有关示例代码，请参阅<span sdata="link"><a href="76ecc05f-a77d-40a2-bab9-91a7fcf17347.htm">更新大型数据的示例</a></span>。</p></td></tr><tr><td><p>TYPE_SS_SCROLL_STATIC</p></td><td><p>静态</p></td><td><p>不反映其他用户的更新。</p></td><td><p>不适用</p></td><td><p>不适用</p></td><td><p>整数值 = 1004。应用程序需要数据库快照。这是 JDBC TYPE_SCROLL_INSENSITIVE 特定于 SQL Server 的同义词，具有相同的并发设置行为。</p><p>从提取大小指定的服务器中分块检索行。</p></td></tr><tr><td><p>TYPE_SS_SCROLL_KEYSET</p><p>(CONCUR_READ_ONLY)</p></td><td><p>键集</p></td><td><p>可滚动，只读。外部行更新可见，删除显示为缺失数据。</p><p>外部行插入不可见。</p></td><td><p>不适用</p></td><td><p>不适用</p></td><td><p>整数值 = 1005。应用程序必须只看到现有行的已更改数据。这是 JDBC TYPE_SCROLL_SENSITIVE 特定于 SQL Server 的同义词，具有相同的并发设置行为。</p><p>从提取大小指定的服务器中分块检索行。</p></td></tr><tr><td><p>TYPE_SS_SCROLL_KEYSET</p><p>（CONCUR_UPDATABLE、CONCUR_SS_SCROLL_LOCKS、CONCUR_SS_OPTIMISTIC_CC、CONCUR_SS_OPTIMISTIC_CCVAL）</p></td><td><p>键集</p></td><td><p>可滚动，可更新。</p><p>外部和内部行更新可见，删除显示为缺失数据；插入不可见。</p></td><td><p>不适用</p></td><td><p>不适用</p></td><td><p>整数值 = 1005。应用程序必须更改现有行的数据或看到现有行的已更改数据。这是 JDBC TYPE_SCROLL_SENSITIVE 特定于 SQL Server 的同义词，具有相同的并发设置行为。</p><p>从提取大小指定的服务器中分块检索行。</p></td></tr><tr><td><p>TYPE_SS_SCROLL_DYNAMIC</p><p>(CONCUR_READ_ONLY)</p></td><td><p>动态</p></td><td><p>可滚动，只读。</p><p>外部行更新和插入可见，删除显示为当前提取缓冲区中的临时缺失数据。</p></td><td><p>不适用</p></td><td><p>不适用</p></td><td><p>整数值 = 1006。应用程序在游标的生存期内必须看到现有行的已更改数据并看到已插入和已删除的行。</p><p>从提取大小指定的服务器中分块检索行。</p></td></tr><tr><td><p>TYPE_SS_SCROLL_DYNAMIC</p><p>（CONCUR_UPDATABLE、CONCUR_SS_SCROLL_LOCKS、CONCUR_SS_OPTIMISTIC_CC、CONCUR_SS_OPTIMISTIC_CCVAL）</p></td><td><p>动态</p></td><td><p>可滚动，可更新。</p><p>外部和内部行更新和插入可见，删除显示为当前提取缓冲区中的临时缺失数据。</p></td><td><p>不适用</p></td><td><p>不适用</p></td><td><p>整数值 = 1006。应用程序可以使用 <b>ResultSet</b> 对象更改现有行的数据或者插入或删除行。应用程序还必须能够从 <b>ResultSet</b> 对象之外看到其他用户所做的更改、插入和删除。</p><p>从提取大小指定的服务器中分块检索行。</p></td></tr></table></div></div><h1 class="heading">游标定位</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>TYPE_FORWARD_ONLY、TYPE_SS_DIRECT_FORWARD_ONLY 和 TYPE_SS_SERVER_CURSOR_FORWARD_ONLY 游标仅支持 <a href="60248447-6908-4036-a779-a501453cd553.htm">next</a> 定位方法。</p><p>TYPE_SS_SCROLL_DYNAMIC 游标不支持 <a href="638e8148-8ca0-4e1f-9ec2-04a11bc9809b.htm">absolute</a> 和 <a href="a266e3bc-05c2-44e2-9346-125ae6780216.htm">getRow</a> 方法。<b>absolute</b> 方法近似等效于针对动态游标组合调用 <a href="67ed9447-7b10-4c87-98e7-f4c2e2470b3a.htm">first</a> 和 <a href="2bcdbb69-95fd-4ae8-8488-1a75a91fe2e0.htm">relative</a> 方法。</p><p><b>getRow</b> 方法仅受 TYPE_FORWARD_ONLY、TYPE_SS_DIRECT_FORWARD_ONLY、TYPE_SS_SERVER_CURSOR_FORWARD_ONLY、TYPE_SS_SCROLL_KEYSET 和 TYPE_SS_SCROLL_STATIC 游标支持。带有所有只进游标类型的 <b>getRow</b> 方法返回迄今为止通过游标读取的行数。</p><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>当应用程序进行不支持的游标定位调用或对 <b>getRow</b> 方法进行不支持的调用时，将引发异常并显示消息“此游标类型不支持所请求的操作”。</p></div><p>仅 TYPE_SS_SCROLL_KEYSET 和等效的 TYPE_SCROLL_SENSITIVE 游标才显示已删除的行。如果游标定位在已删除的行上，则列值不可用并且 <a href="9c6db315-e614-4604-b020-41af6a214cc1.htm">rowDeleted</a> 方法返回“true”。对 <b>get&lt;Type&gt;</b> 方法的调用将引发异常并显示消息“无法从已删除行获取值”。无法更新已删除的行。如果您尝试对已删除的行调用 <b>update&lt;Type&gt;</b> 方法，将引发异常并显示消息“无法更新已删除的行”。TYPE_SS_SCROLL_DYNAMIC 游标具有这种相同的行为，直到将此游标移出当前提取缓冲区之外。</p><p>前进游标和动态游标以类似的方式显示已删除的行，但仅限仍可在提取缓冲区中访问游标的情况。对于前进游标，这一点相当简单。对于动态游标，当提取大小大于 1 时，这一点就变得较复杂了。应用程序可以在由提取缓冲区定义的窗口内前后移动游标，但是，当离开在其中更新已删除行的原始提取缓冲区时，已删除的行将消失。如果应用程序并不希望通过使用动态游标来查看临时删除的行，则应使用 Fetch Relative (0)。</p><p>如果使用游标更新 TYPE_SS_SCROLL_KEYSET 或 TYPE_SCROLL_SENSITIVE 游标行的键值，则行将保持其在结果集中的原始位置，无论已更新的行是否符合游标的选择条件。如果在游标之外更新行，则已删除的行将出现在该行的原始位置，然而，该行仅当游标中存在具有新键值的另一行但它先前已被删除时才会出现在游标中。</p><p>对于动态游标，已更新的行将保留其在提取缓冲区的位置，直到离开由提取缓冲区定义的窗口。已更新的行随后可能重新出现在结果集内的不同位置，或者可能完全消失。必须避免结果集中出现临时不一致的应用程序所使用的提取大小应为 1（对于 CONCUR_SS_SCROLL_LOCKS 并发机制，默认值为 8 行；对于其他并发机制，则为 128 行）。</p></div><h1 class="heading">游标转换</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>SQL Server 有时选择实现的游标类型与所请求的游标类型不同，这称为隐式游标转换（或游标降级）。有关隐式游标转换的详细信息，请参阅 SQL Server 联机丛书中的“使用隐式游标转换”主题。</p><p>对于 SQL Server 2000，当您通过 <b>ResultSet.TYPE_SCROLL_SENSITIVE</b> 和 <b>ResultSet.CONCUR_UPDATABLE</b> 结果集更新数据时，将引发异常并显示消息“游标是只读的”。发生此异常的原因是 SQL Server 2000 已针对该结果集执行了隐式游标转换，而不返回所请求的可更新游标。</p><p>若要解决此问题，可以采用以下两种解决方案之一：</p><ul><li><p>确保基础表具有主键</p></li><li><p>创建语句时，使用 <a href="d87afd89-3e75-402c-b844-1b434eb258df.htm">SQLServerResultSet.TYPE_SS_SCROLL_DYNAMIC</a>，而不使用 <b>ResultSet.TYPE_SCROLL_SENSITIVE</b>。</p></li></ul></div><h1 class="heading">游标更新</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p>对于游标而言，如果游标类型和并发支持更新，则支持对游标进行就地更新。如果游标未定位在结果集中的可更新行上（<b>get&lt;Type&gt;</b> 方法调用未获成功），则调用 <b>update&lt;Type&gt;</b> 方法将引发异常并显示消息“结果集没有当前行”。JDBC 规范规定，对类型为 CONCUR_READ_ONLY 的游标的列调用 update 方法时，将引发异常。在由于乐观并发冲突（如相互竞争更新或删除）等此类原因而导致无法更新行的情况下，可能不会引发异常，直到调用 <a href="363d1008-1396-4fc0-8e27-c9ba2499e7f1.htm">insertRow</a>、<a href="cfced0ca-a281-40dc-8d2f-370d5f0bf12b.htm">updateRow</a> 或 <a href="aa04a644-c7c2-4738-8b6e-7fea566d2c16.htm">deleteRow</a>。</p><p>在调用 <b>update&lt;Type&gt;</b> 之后，<b>get&lt;Type&gt;</b> 将无法访问受影响的列，直到调用了 <b>updateRow</b> 或 <a href="2ecacca4-f7bc-4f5d-886a-da7747fdccae.htm">cancelRowUpdates</a>。这将避免以下问题：使用与服务器返回的类型不同的类型更新列，而随后调用的 getter 可能会引起给出不准确结果的客户端类型转换。调用 <b>get&lt;Type&gt;</b> 将引发异常并显示消息“在调用 updateRow() 或 cancelRowUpdates() 之前，无法访问已更新列”。</p><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>如果在未更新任何列时调用 <b>updateRow</b> 方法，JDBC 驱动程序将引发异常并显示消息“在未更新任何列时调用了 updateRow()”。</p></div><p>在调用了 <a href="f3c54bfe-d5b7-4f6e-ae6c-3e8954e5b1c9.htm">moveToInsertRow</a> 之后，如果对结果集调用了除 <b>get&lt;Type&gt;</b>、<b>update&lt;Type&gt;</b>、<b>insertRow,</b> 和游标定位方法（包括 <a href="9a7c754c-2d72-4207-b3bd-2afc6047fb3d.htm">moveToCurrentRow</a>）之外的任何其他方法，则将引发异常。<b>moveToInsertRow</b> 方法有效地将结果集置于插入模式，而游标定位方法会终止插入模式。相对游标定位调用会将游标相对于它在调用 <b>moveToInsertRow</b> 之前所处的位置进行移动。在游标定位调用之后，最终的目标游标位置将成为新的游标位置。</p><p>如果在插入模式下进行的游标定位调用未获成功，则调用失败之后的游标位置为调用 <b>moveToInsetRow</b> 之前的原始游标位置。如果 <b>insertRow</b> 失败，游标将保持在插入行，并且游标保持在插入模式下。</p><p>位于插入行中的列最初处于未初始化状态。调用 <b>update&lt;Type&gt;</b> 方法可将列状态设置为已初始化。对于未初始化的列调用 <b>get&lt;Type&gt;</b> 方法将引发异常。调用 <b>insertRow</b> 方法会将位于插入行中的所有列返回到未初始化状态。</p><p>如果在调用 <b>insertRow</b> 方法时任何列均未初始化，则将插入列的默认值。如果没有默认值而列可为 Null，则插入 NULL。如果没有默认值且列不可为 Null，服务器将返回错误，此时将引发异常。</p><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p /><p>在插入模式下，调用 <b>getRow</b> 方法将返回 0。</p><p>JDBC 驱动程序不支持定位更新或删除。根据 JDBC 规范，调用 <a href="3f3ec4f2-103a-4e16-9206-c5bd8639f946.htm">setCursorName</a> 方法将不起任何作用，而调用 <a href="e5b3af67-423a-4551-a4c6-a4bc076bd504.htm">getCursorName</a> 方法将引发异常。</p><p>只读和静态游标始终无法更新。</p><p>SQL Server 将服务器游标限制到单一结果集中。如果批处理或存储过程包含多条语句，则必须使用只进只读客户端游标。</p></div></div><span id="seeAlsoSpan"><h1 class="heading">请参阅</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="9ed5ad41-22e0-4e4a-8a79-10512db60d50.htm">通过 JDBC 驱动程序管理结果集</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">发送有关本主题的<a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\d感谢您提供反馈。开发人员写作组将利用您的反馈来改进文档质量。我们在审阅您的反馈时，可能会给您发送电子邮件提出问题或询问您对某个解决方案的意见。您的电子邮件地址不会被用于其他用途，我们在完成审阅之后即会将其删除。%0\A有关%20Microsoft%20隐私策略的其他信息，请参阅%20http://privacy.microsoft.com/zh-CN/default.aspx。%0\A%0\d','客户反馈');">反馈</a>至 Microsoft。</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft。保留所有权利。</a></p></span></div></div></body></html>